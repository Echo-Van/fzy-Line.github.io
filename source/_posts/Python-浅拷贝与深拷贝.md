---
title: Python 浅拷贝与深拷贝
abbrlink: 28148
date: 2019-01-20 23:51:13
tags:
  - Python
categories:
  - Coding
  - Python
---

<center>Python 赋值、浅拷贝与深拷贝总结。</center>

<!--more-->

#### 可变/不可变对象

- **不可变对象，该对象所指向的内存中的值不能被改变。**当改变某个变量时候，由于其所指的值不能被改变，相当于把原来的值复制一份后再改变，这会开辟一个新的地址，变量再指向这个新的地址。
- **可变对象，该对象所指向的内存中的值可以被改变。**变量（准确的说是引用）改变后，实际上是其所指的值直接发生改变，并没有发生复制行为，也没有开辟新的出地址，通俗点说就是**原地改变**。

　　Python中，**数值类型（int和float）、字符串str、元组tuple都是不可变类型。而列表list、字典dict、集合set是可变类型。**

#### 赋值

　　对于不可变对象(字符串、元组、数值)的赋值：

```python
>>> a = 6
>>> b = a
>>> print(a, b)
6 6
>>> a = 2   # 修改a，b不变
>>> print(a, b)
2 6
```

　　对于可变对象(列表、字典、集合等)的赋值：

```python
>>> a = [1, 2, 3, [4, 5]]
>>> b = a
>>> print(a, b)
[1, 2, 3, [4, 5]] [1, 2, 3, [4, 5]]
>>> a[1] = 6
>>> print(a, b) # 修改a中的值，b也变了
[1, 6, 3, [4, 5]] [1, 6, 3, [4, 5]]
```

#### 浅拷贝

　　在 python 中，标识一个对象唯一身份的是：对象的`id`(内存地址)，对象类型，对象值，而浅拷贝就是创建一个具有相同类型，相同值但不同`id`的新对象。

　　对可变对象而言，对象的值一样可能包含有对其他对象的引用，浅拷贝产生的新对象，虽然具有完全不同的`id`，但是其值若包含可变对象，这些对象和原始对象中的值包含同样的引用。

```python
>>> a = [1, 2, 3, [4, 5]]
>>> b = a.copy()    # list的copy方法，浅拷贝
>>> print(a, b)
[1, 2, 3, [4, 5]] [1, 2, 3, [4, 5]]
>>> a[1] = 6
>>> print(a, b) # 修改a中的不可变对象，b不变
[1, 6, 3, [4, 5]] [1, 2, 3, [4, 5]]
>>> a[3].append(7)  # 修改a中的可变对象时，b也变了
>>> print(a, b)
[1, 6, 3, [4, 5, 7]] [1, 2, 3, [4, 5, 7]]
```

　　`list.copy()` 浅拷贝：复制此列表(只复制一层，不会复制深层对象) 等同于 L[:] 。如上所示，浅拷贝产生的新对象中可变对象的值在发生改变时会对原对象的值产生副作用，因为这些值是同一个引用。

　　浅拷贝仅仅对对象自身创建了一份拷贝，而没有在进一步处理对象中包含的值。因此使用浅拷贝的典型使用场景是：对象自身发生改变的同时需要保持对象中的值完全相同，比如 list 排序。

　　在 `copy` 模块中，也提供了 `copy` 方法可以完成浅拷贝。

```python
from copy import copy
```

#### 深拷贝

　　列表没有深拷贝方法，但是 `copy` 模块中提供了 `deepcopy` 方法可以完成深拷贝。

```python
from copy import deepcopy
```

　　相比于浅拷贝，深拷贝不仅仅拷贝了原始对象自身，也对其包含的值进行拷贝，它会递归的查找对象中包含的其他对象的引用，来完成更深层次拷贝。因此，深拷贝产生的副本可以随意修改而不需要担心会引起原始值的改变。

```python
>>> import copy # list没有deepcopy方法
>>> a = [1, 2, 3, [4, 5]]
>>> b = copy.deepcopy(a)    # 深拷贝
>>> a[3].append(6)  # 即使修改a中的可变对象，b也不变
>>> print(a, b)
[1, 2, 3, [4, 5, 6]] [1, 2, 3, [4, 5]]
```

　　值得注意的是，深拷贝并非完完全全递归查找所有对象，因为一旦对象引用了自身，完全递归可能会导致无限循环。一个对象被拷贝了，python 会对该对象做个标记，如果还有其他需要拷贝的对象引用着该对象，它们的拷贝其实指向的是同一份拷贝。

#### 总结

1. 赋值是将一个对象的地址赋值给一个变量，让变量指向该地址（旧瓶装旧酒）。

1. 浅拷贝是在另一块地址中创建一个新的变量或容器，但是容器内的元素的地址均是源对象的元素的地址的拷贝。也就是说新的容器中指向了旧的元素（新瓶装旧酒）。

1. 深拷贝是在另一块地址中创建一个新的变量或容器，同时容器内的元素的地址也是新开辟的，仅仅是值相同而已，是完全的副本。也就是说（新瓶装新酒）。