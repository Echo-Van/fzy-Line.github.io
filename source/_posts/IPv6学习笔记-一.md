---
title: IPv6学习笔记(一)
date: 2016-12-19 11:30:41
tags: [网络,IPv6]
categories: Network
---

　　IPv6是Internet Protocol Version 6的缩写，IPv6是IETF（互联网工程任务组，Internet Engineering Task Force）设计的用于替代现行版本IP协议（IPv4）的下一代IP协议，号称可以为全世界的每一粒沙子编上一个网址。

此篇博客主要学习IPv6的特点、IPv6数据报格式、IPv6地址格式与分类。

<!--more-->

#### IPv6与IPv4比较

##### IPv4的局限性

- IP地址枯竭
- 报头过于复杂,使网络节点处理效率不高
- NAT技术破坏了端到端应用模型，不安全
- 地址配置与使用不够简便
- IPv4协议本身的安全性不足
- QoS功能难以满足显示要求

##### IPv6的技术优势

- 超大的地址空间，地址增加了2^96倍
- 自动配置用户地址，提供即插即用功能，路由器可以简单路过选项而不做任何处理，加快了处理速度
- 全球重新部署，有规划，易于实现聚合
- 报头简单，加快报文转发，提高了吞吐量，能通过扩展报头技术可实现新技术
- IPv6支持永远在线，为人们提供更友好的服务
- 内置的安全机制，如IPSec
- 增强了对移动IP的支持

##### IPv4与IPv6对比表

比较内容 | IPv6 | IPv4
---|---|---
地址空间 |  2的128次方，足够大 | 2的32次方，约42亿
表示方法 | 冒号十六进制 | 点分十进制
安全性 | 采用标准的方法，以支持全球范围的内部网接入和虚拟专用网 | 几个可选方法，每个可选方法都有由有限的地址空间引起的扩展性问题
移动IP网络配置 | 规模可支持全球移动终端IPv6标准的一个完整的组成部分 | 可支持有限数量的终端，无综合的标准化解决方案

#### IPv6数据报

![19-1](http://ohe7ixo05.bkt.clouddn.com/2016/12/19-1.png)

##### IPv6数据报基本结构

**（1）Ipv6报头**

Ipv6报头由40个字节的固定长度组成，相比Ipv4报头，删去了报头长度、标示、标志、检验和等字段。

**（2）扩展报头**

在IPv6中用扩展报头来代替Ipv4中的部分选项字段。新的扩展报头格式增强了IPv6的功能，使其具有极大的扩展性。

**（3）上层协议数据单元**

由上层协议报头和有效载荷构成。有效载荷可以是ICMPv6报文、TCP报文、UDP报头等。

##### IPv6数据报的报头格式

![19-2](http://ohe7ixo05.bkt.clouddn.com/2016/12/19-2.png)

- 版本号(version)

    不同的IP协议版本使用不同的数据报格式。

- 通信量等级(Traffic Classes)

    使得源节点和路由器能够识别IPv6信息包的优先级。与IPv4服务类型TOS字段含义类似。

- 流标签(Flow Label)

    标记那些需要IPv6路由器特殊处理(如一种非默认服务质量或实时服务)的信息包顺序。

- 有效负载长度(Payload Length)

    定长40字节数据报首部后面的字节数量，包括扩展报头和负载数据，即数据报长度-40。

- 下一个首部(Next Header)

    当IPv6没有扩展报头时，该字段的作用和IPv4的上层协议字段一样。当含有扩展报头时，该字段的值即为第一个扩展报头的类型。

- 跳限制(Hop Limit)

    转发数据报的每台路由器对该字段的值减1，若减为0则丢弃该数据报。

- 128位源IP地址(Source Address)

- 128位目的IP地址(Destnation Address)

#### IPv6地址格式

- IPv6二进位制下为128位元长度
- 以16位元为一组，每组以冒号":"隔开
- 可以分为8组，每组以4位元十六进制方式表示

##### 首选格式

IPv6地址表示为冒号分十六进制格式

例如： 21DA:00D3:0000:0000:02AA:00FF:FE22:9C5A

##### 压缩表示

压缩规则1：每项数字前导的0可以省略，省略后前导数字仍是0则继续。例如，以下IP地址都是等价的：

```
2001:0DB8:02de:0000:0000:0000:0000:0e13
2001:DB8:2de:0000:0000:0000:0000:e13
2001:DB8:2de:000:000:000:000:e13
2001:DB8:2de:00:00:00:00:e13
2001:DB8:2de:0:0:0:0:e13
```

压缩规则2：可以用双冒号"::"表示一组0或多组连续的0

```
2001:DB8:2de:0:0:0:0:e13
2001:DB8:2de::e13
```

不过一个IPv6地址只允许使用一次“::”，请注意有的情形下省略是非法的.

```
2001::25de::cade
```

因为它有可能是下种情形之一，造成无法推断。
```
2001:0000:0000:0000:0000:25de:0000:cade
2001:0000:0000:0000:25de:0000:0000:cade
2001:0000:0000:25de:0000:0000:0000:cade
2001:0000:25de:0000:0000:0000:0000:cade
```

##### 内嵌IPv4地址的IPv6地址表示

IPv4兼容IPv6地址    例如：::192.168.1.2

IPv4映射IPv6地址    例如：::FFFF:192.168.1.2

##### 地址前缀

IPv6地址的地址前缀同IPv4中的CIDR一样，依然使用“地址/前缀长度”表示，例如：2001:da8:0:2::/64

所有无状态自动配置的地址的前缀都是fe80，其后64位是由48位的MAC地址生成的.

#### IPv6地址类型

![19-3](http://ohe7ixo05.bkt.clouddn.com/2016/12/19-3.png)

##### 单播地址

只能分配给一个节点上的一个接口，即寻址到该单播地址的数据报文最终会被发送到一个唯一的接口。

##### 组播（多播）地址   

所谓组播，是指一个源节点发送的单个数据报文能被特定的多个目的节点接收到，路由器转发组播数据是根据组播路由协议学习到得拓扑结构进行的，适合于One-to-Many的通信场合。在IPv6网络中，组播地址也由特定的前缀FF::/8来表示。

##### 任播（泛播）地址   

这是IPv6特有的地址类型，用来标示一组网络接口（通常属于不同的节点）。但与组播地址不同，路由器会将目的地址作为任播地址的数据报文，发给距本路由器最近的一个网络接口。适用于One-to-One-of-Many的通信场合。

##### 有特殊含义的地址

**（1）未指定位址**

::/128：所有位元皆为零的位址称作未指定位址。这个位址不可指定给某个网路介面，并且只有在主机尚未知道其来源IP时，才会用于软体中。路由器不可转送包含未指定位址的封包。

**（2）Link local位址**

::1/128：是一种单播绕回位址。如果一个应用程式将封包送到此位址，IPv6堆叠会转送这些封包绕回到同样的虚拟介面（相当于IPv4中的127.0.0.1）。
fe80::/10－ 这些link-local位址指明，这些位址只在区域连线中是合法的，这有点类似于IPv4中的169.254.0.0/16。

**（3）Solicited-node多播位址**

ff02::1:FFXX:XXXX－XX:XXXX：为相对应的单播或任播位址中的三个最低的位元组

**（4）唯一区域位域**

fc00::/7：唯一区域位址（ULA，unique local address）只可在一群网站中发送。这定义在RFC 4193中，是用来取代site-local位域。这位址包含一个40位元的伪随机数，以减少当网站合并或封包误传到网路时碰撞的风险。这些位址除了只能用于区域外，还具备全域性的范畴，这点违反了唯一区域位域所取代的site-local位址的定义。

**（5）多播位址**

ff00::/8：这个前置表明定义在"IP Version 6 Addressing Architecture"（RFC 4291）中的多播位址。其中，有些位址已用于指定特殊协议，如ff0X::101将到达所有区域的NTP伺服器（RFC 2375）。
