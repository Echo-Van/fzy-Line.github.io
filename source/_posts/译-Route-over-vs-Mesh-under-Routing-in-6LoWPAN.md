---
title: '[译]Route-over vs Mesh-under Routing in 6LoWPAN'
tags:
  - IoT
  - 6LoWPAN
  - Route
categories: 论文研读
mathjax: true
abbrlink: 26629
date: 2017-03-26 23:02:53
---

　　6LoWPAN中的路由协议划分为两类：mesh-under和route-over。对于mesh-under方案的路由决策是在适适配层，而路由router-over方案的决策发生在网络层。分析了route-over和mesh-under路由方案的概率模型，并从不同的角度对这两种方案进行了评估。

<!--more-->

　　摘要：通过低功耗无线个人区域网络（6LoWPAN）传输IPv6数据包被认为几乎不可行。 IPv6数据包的大小远大于IEEE 802.15.4数据链路层的数据包大小。6LoWPAN在网络和数据链路层之间实现适配层。适配层的主要目的是分片和重组IPv6数据包。适配层的实现增强了网络层和适配层之间的路由/转发决策。根据在适配层或网络层上进行的路由决策，我们可以将6LoWPAN中的路由方案划分为两类：mesh-under和route-over。在本文中，我们在分组/分片到达概率，总传输次数和源和目的地之间的总延迟方面，对这两个方案进行分析比较。我们还比较了mesh-under和route-over方案之间的选择性分片重传机制。

　　关键词：6LoWPAN,routing,WSN

#### 引言

　　IEEE 802.15.4 标准为低功率无线个人区域网络定义了一个无线链路，广泛应用于诸如栖息地监测，楼宇自动化，安全，物体跟踪，核反应堆控制，火灾探测和交通监控等嵌入式应用。它同样也被用于几个以人为中心的应用程序，比如健康检查，设备互连和健身相关的应用。大面积实现这些应用程序需要庞大数量的低功耗和低成本的节点/设备。它也被认为这些应用程序应该有一个延长生命周期。

　　IEEE 802.15.4网络设备相比其他无线个域网或无线局域网有能力有限。IEEE 802.15.4的关键特性是127字节的小MTU大小，250kbps的低数据速率，如果它在2.4 GHz频段，短距离通信和内置的AES-128加密和认证方法中工作。除了长地址（64-bit EUID），它也支持16位的设备短地址。因此，这些短地址降低了通信开销并在WPAN(无线个人局域网通讯技术)内保持独特的通信。LoWPAN(低功耗无线个人区域网络)设备的典型RAM大小范围为2KB到10KB。 IPv6是互联网层协议和IPv4的后继者。IPv6解决了从32位到128位的IP地址空间，IPv6的最小MTU为1280字节。由于认为IP时资源密集的，并且IPv6的MTU为1280字节，然而IEEE 802.15.4数据链路层的MTU为127字节，所以通过LoWPAN传输IPv6数据包是困难的。

　　6LoWPAN由IETF定义，在RFC4919中标准化和描述。6lowpan实现网络层和数据链路层支持6LoWPAN IPv6数据包的传输在锡安之间的适配层。

　　6LoWPAN由IETF标准定义，并在RFC 4919中描述。 6LoWPAN在网络和数据链路层之间实现适配层，以支持通过LoWPAN传输IPv6数据包。在实施适配层之后，可以在传统网络层或适配层中进行路由/转发决策。如果在网络层中采用路由决策，我们将其称为router-over，如果在适配层中采用该决策，则称之为mesh-under。

　　本文的贡献是对6LoWPAN中的mesh-under和route-over路由方案的分析。我们展示了这两种方案在片段/分组到达概率，重传策略，源与目的地之间的总延迟（基于分组中的片段数））和源与目的地之间的跳数的差异。本文的其余部分描述如下：第2节描述了6LoWPAN的背景。第3节描述了mesh-under和route-over路由方案。第4节对这两个方案进行了一个数学比较。第5节讨论了我们的观察结果，最后是第6节。

#### 背景

　　IETF标准定义了6LoWPAN的概述，假设，问题陈述和目标。IPv6的分组大小远大于IEEE 802.15.4数据链路层的MTU，导致IPv6分组的分片和压缩。能源效率也是6LoWPAN传输的重要问题。 6LoWPAN是关于如何通过LoWPAN传输IPv6数据包的IETF标准，这在RFC 4944中有描述。 6LoWPAN在TCP/IP协议栈中的数据链路和网络层之间引入了适配层。它通过使用报头压缩和分片IPv6数据包来支持IPv6数据包的最小MTU，大大降低了IP传输开销。6LoWPAN还使用数据链路层中的多跳转发，通过多跳方案从源到目的地传递IPv6数据包。采用适配层的一个字节调度值来确定帧是否为LoWPAN帧。如果帧是LoWPAN帧，那么类型特定的报头将作为调度值的一部分进行。对于特定类型头的具体值，可能存在未压缩/压缩的IPv6报头，分段报头，Mesh报头或广播报头。如果IP数据包的大小大于数据链路层的MTU，则分片是必不可少的。分片头在适配层的调度值之后发生。分片头的出现由调度字节的特定值决定。由于分片的简单性，第一片段和后续片段的调度值是不同的。片段的偏移量只能显示八个字节长度的倍数。所以除了最后的片段，所有其他片段都是八个字节的倍数。如果同一分组中有多个报头，则依次放置mesh寻址报头，广播报头和分片报头。

　　文献1提到了mesh-under和route-over的问题。6LoWPAN架构解决了6LoWPAN的route-over和mesh-under路由方案的许多问题。IETF 6LoWPAN工作组还负责定义6LoWPAN路由的问题陈述和要求。相关作品[1]和[11]仅讨论了mesh-under和route-over方案的一些问题。但是，它们不提供mesh-under和route-over方案之间的任何分析比较。

#### 6LoWPAN的路由

　　6LoWPAN中的路由协议是敏感的，因为节点的能力在能量，传输范围等方面受到限制。LoWPAN（[7]-[10]）的路由协议已经有很多发展。基于应用场景，6LoWPAN中的路由可以分为：泛洪，数据感知路由，地理路由，概率路由，事件驱动，基于查询的路由和分层路由。

路由决策基于哪个层，即数据转发发生在哪个层，我们可以将6LoWPAN中的路由协议划分为两类：mesh-under和route-over。图1 显示了路由决策发生在TCP/IP 6LoWPAN协议栈的哪一层。对于mesh-under方案的路由决策是在适适配层，而路由router-over方案的决策发生在网络层。在route-over和mesh-under方案中的路由问题主要区别在于包/分片的转发过程而不是路由建立阶段。下面的小节详细描述了route-over和mesh-under路由方案上的细节。

##### Mesh-under

　　在Mesh-under方案中，在一个LoWPAN内部网络层不执行IP路由。适配层执行执行mesh路由并通过多跳转发包到目的地。在Mesh-under方案中，基于802.15.4帧或6LoWPAN头的链路层进行路由转发。要将数据包发送到特定目的地，使用EUI 64位地址或16位短地址并将其发送到邻居节点，以使数据包更接近目的地。多个链路层跳被用于完成单个IP跳，因此称为mesh-under。6LoWPAN采用源地址和目的地址的思想，分别描述PAN内单个IP跳的起始源地址和最终目标节点。由于链路层发起者和最终目的地址包含在6LoWPAN报头中，所以适配层上的任何协议的mesh传递是可能的。IP包被适配层分段到多个分片。这些片段通过mesh路由传递到下一跳，最终到达目的地。IP分组的不同分片可以通过不同的路径，并且它们在目的地聚集。如果所有分片都成功到达，则目标节点的适配层重新组合所有分片并创建IP包。在转发过程中丢失任何分片的情况下，将整个IP分组（即该IP分组的所有片段）重传到目的地以进行恢复。

##### Route-over

　　通常在route-over方案中，所有路由决策都在网络层中进行，每个节点充当IP路由器。在路由过程中，每个链路层跳是一个IP跳。IP路由支持在这些链路之间转发数据包。在转发过程中，使用IP路由表和IPv6逐跳选项。对于路由和转发过程，网络层使用附加的封装IP报头进行决策。6LoWPAN的适配层建立了帧和IP报头之间的直接映射。当IP包被适配层分段时，根据路由表信息将片段发送到下一跳。下一跳的适配层检查接收的片段。如果所有片段都被成功接收，则适配层从片段中创建一个IP包，并将其发送到网络层。如果分组发往自己，则网络层将IP分组发送到传输层，否则根据路由表信息将分组转发到下一跳。如果有一个或多个片段丢失，则所有片段都被重传到一跳距离。在成功接收到所有片段后，适配层从这些片段创建一个IP包，并将其传递到网络层。网络层然后基于分组的目的地和路由表信息转发或处理IP分组。

##### Mesh-under的选择性重传

　　通常在mesh-under方案中，如果一个或多个片段在路由路径中丢失，则所有片段都将从源重传到目的地。我们可以使用基于从目的地到源的选择性否定确认（NACK）的选择性分片重传机制。根据NACK，仅重传丢失的片段，并将先前发送的分片保存在目的地的缓冲区中。然后，目的地的适配层从保存的和新接收的分片创建一个IP包。本文称之为“Mesh-under选择重传(SRMU)”。

##### Route-over的选择性重传

　　通常在Route-over方案中，如果路径中丢失了一个或多个分片，则所有分片都将重新发送到下一跳。如果一个或多个分片在一跳距离内的发送者和接收者之间丢失，则可以向发送者确认选择性NACK以重传丢失的片段。我们可以将所有片段保存在下一跳的缓冲区中。在成功接收到丢失的片段之后，适配层将保存的和新接收的片段重新组合到IP包中。本文将全过程命名为“Route-over的选择重传(SRRO)”。

#### 分析

　　在这一部分，我们找出了Route-over和Mesh-under方案的概率模型。假设从网络层接收的IP包被适配层划分为f个片段。此外，假设h是从源到目的地的每个片段所经历的跳数。

##### 无恢复情况下的能源效率

　　在route-over的情况下，任何中间跳的任何片段的丢失导致所有后续接收的片段的丢弃。而在mesh-under的情况下，如果在中间跳段丢失了任何片段，则其余片段将被传播到目的地，因为除了目的地节点之外，整个网络中的每个片段被独立处理。因此，route-over恢复方案比在mesh-under下节点更节能，因为它不向下一跳发送任何不必要的分片。

##### 分片到达概率

　　令p是在单次尝试中分片在一跳距离中成功到达的概率。N是将分片发送到下一跳的重试次数。因此，在N次重试之后，到达一个片段的概率Pro到一跳距离由方程式1给出。

$$ P\_{ro} = \sum\_{i=1}^Np(1-p)^{i-1}  $$


在route-over方案中，丢失的片段以逐跳的方式被恢复。因此，对于h跳距离，到达多跳距离的概率是相同的，因为每次将所有分片重新组合、分片并以相同的概率发送到下一跳。

　　由于mesh-under方案中丢失的分片是进行端到端的检查，则对于特定次数的重传N和对于h跳距离，分片到达的概率为等式2Pmu。

$$ P\_{mu} = {(\sum\_{i=1}^{N}p{(1-p)}^{i-1})}^h $$


　　图2显示了在分片的目的地的分片到达概率，它是对于一跳距离的重传2次进行7跳的概率。我们观察到对于route-over的情况，到达分片的概率比mesh-under更高。原因是，在每一跳IP数据包需要重新重组然后再以初始概率发送。然而，对于mesh-under的情况，在中间节点上没有创建IP数据包，每个分片单独到达目的地。所以，每次跳完后概率降低了。

##### 总共传输的数据包

　　在本节中，我们假设最短路由路径是指消息在源与目的地中间节点的成功到达。假设这样，我们要确定在第i个中间节点开始的成功传递或到达消息的预期消息数量，分别达到源或目的地之前，即0，n。这里我们称这个量为 $ m\_i $`，i = 1，...，n - 1。概率$ j^{th} , j≥1 $，消息在任何中间节点成功到达。我们想要找出与最终目的地通信所需的中间节点/跳数的预期数量。令B，公式3，是源和目的地之间的中间节点的最小数量。

$$ B = Min\{m:\{\sum\_{j=1}^{m}X_j = -i\}\} $$

　　每个中间跳被认为是成功地接收并发送分组到下一跳或最终目的地。在路线超过方程式的成功传输的总预期数量公式4。

$$ E[\sum\_{j=1}^{B}X\_j] = pE[B] - q $$

　　这里的E[B]，公式7，表示预计最快的渡轮数量，$ E[\sum\_{j=1}^{B}X\_j] $ 表示从源到目的地成功传输的预期数目。成功路由的包，例如公式5，取决于在每个跳的几何概率分布。

$$ \sum\_{j=1}^{B}X\_j = \begin{cases} n-i & with prob.\alpha,\\ -i & with prob.(1-\alpha) \end{cases} $$

$$ (2q-1)E[B] = \alpha - i $$

$$ E[B] = \frac {1} {2p-1} (\frac {n[1-(q/p)^i]} {1-(q/p)^n} - i)  $$

　　p是在$ q=1-p $是每跳的故障概率时接收和转发分组/片段的成功概率。

##### 在源与目的地之间的总延时

　　令Tw为在竞争期间的等待时间，Tp是分片的传播延时，Tnp是分片的节点处理时间。令h为经历的跳数，f为分片的数量。mesh-under方案的总的端到端传输延时Ttmu为：

$$ T\_{tmu} = (T\_w + T\_p)h + T\_{np}(h - 1) + (f - 1)(T\_w + T\_p) $$

　　在公式9中，$ (T\_w + T\_p)h $是在一个竞争周期总的等待时间和总的传输延时的和，$ T\_{np}(h - 1) $节点处理时间的总和，$ (f - 1)(T\_w + T\_p) $是路由中所有分片除了第一个节点之外的所有节点的总等待时间。

router-over路由方案的总传输延时$ T\_tro $为：

$$ T\_{tro} = (T\_w + T\_p)f\*h + (h - 1)\*(T\_{np} + \delta) $$

　　在公式10中，$ \delta $是在中间跳的重组和分片的时间。这里，$ (T\_w + T\_p)f\*h $是一个竞争周期等待时间和传播f个分片经历h跳的延时。$  (h - 1)\*T\_{np}  $中间节点处理和重组的时间。route-over方案包括中间节点IP包分片重组的延时。因此，在源到目的地之间的总的延时mesh-under方案表现要比route-over方案更好。

##### 缓冲区大小

　　传感器节点的缓冲区大小有限。Route-over和SRRO恢复机制存储所有分片并等待其他分片。如果网络的流量太多并且一个节点正在接收来自不同节点的数据包（作为中间跳），则会有缓冲区溢出的可能。另一方面，在mesh-under或SRMU中，由于没有逐跳恢复，所以如果网络流量过多，中间节点的缓冲区大小也不会生效。

##### 端到端恢复的SRRO和逐跳恢复的SRMU比较

　　mesh-under和route-over可以分别被看作是端到端的和逐跳的，在传统的mesh-under或route-over方案中，当一个IP分组发送到目的地或者下一跳并且如果由于IP分组大小而发生分片，则根据方案必须在下一跳或者目的地重新组合分片。

　　对于SRMU，如果一个IP数据包被分片成F个片段并且经过H跳传输到目的地，那么预期的到达目的地的分片数在等式11给出：

$$ E[f(F,H)] = \sum\_{m=1}^Fm.P\_{mu}^m (1 - P\_{mu})^{F-m} $$


　　$ P\_{mu} $是由等式2得到的mesh-under下的端到端概率。如果我们传输一个分片经过H跳，那么分片期望经过的跳数$E[f_h(H)] $，由等式12给出。

$$ E[f\_h(H) = \sum\_{m=1}^{H-1}m.P\_{mu}^{m-1}(1 - P\_{mu}) $$

　　在一次尝试中发送F个片段的近似成本是$ C\_{apx} $

$$ C\_{apx} = H.E[f(F.H)] + E[f\_h(H)].(F - E[f(F,H)]) $$


　　在SRMU的情况下，如果有一些片段丢失，而第一次尝试，我们发送一个选择性的NACK，只重新传输丢失的片段。因此，在第二次尝试中，我们可以获得多少个片段已经丢失并重传，并使用公式11到13获得传输计数。对于第k次尝试中的片段传输故障的情况，我们可以递归地计算后续步骤的传输次数。如果我们添加所有这些传输计数，我们可以获得SRMU机制的片段传输总数。

　　对于SRRO的情况，恢复是逐跳进行的。因此，IP数据包将到达下一跳并且下一跳将缓存分片并检查所有分片是否到达。如果有任何分片传输失败我们发送一个选择性NACK来只重传丢失的分片。因此，当所有分片到达下一跳（或者目的地）6LoWPAN适配层将重组所有分片并创建一个IP数据包。因此IP数据包将从源到目的地遍历。对于SRRO案例，在一跳成功移动一个分片期望的重试次数是

$$ E[r(N)] = \sum\_{k=1}^{\infty} k.P\_{ro}(1 - P\_{ro})^{k - 1} $$

　　$ P\_{ro} $是由公式1得到的route_over的概率。因此，对于H跳，如果来自IP数据包的片段数为F，则传输的总数为

$$ E[f(H,F)] = F.H.E[r(N)] $$

　　如果我们计算发送IP包的总数量超过H跳距离，那么我们观察到从公式11-15 SRRO需要的传输数量少于SRMU。如果跳数或来自IP包的片段数量增加，差异将迅速增加。RMST[6]也向我们展示了传输层的逐跳对端到端恢复相似的分析。他们还表明，逐跳式表现优于端对端恢复方案。从分析可以看出，如果我们实现选择性NACK并仅重新传输丢失的片段，那么与传统的网格或路由选择方案的恢复相比，它将减少重传的总数。

#### 观察

　　从route-over和mesh-under方案的概率分析可以看出，对于目的地的分片到达率，route-over可能比mesh-under更高效。如果发生一个或多个分片故障，route-over和mesh-under方案都会重传所有片段，从而在网络中产生额外的开销。选择性分片重传机制 (SRRO 或 SRMU)可能可以克服这个问题。我们知道传感节点的缓冲区大小是有限的，因此如果网络内产生的流量太大并且一个节点被用作多个传输路径的中间节点，那么在route-over方案中缓冲区可能会溢出。然后，在mesh-under方案中间节点没有溢出的可能性。在总延时方面，mesh-under方案优于route-over方案。route-over方案对于在路径中有更多机会丢失分片的环境是有益的，因为它的逐跳恢复机制。另一方面，mesh-under方案在中间节点没有重组和分片的任何开销，但是如果IP分组的大小非常大或路由路径中的跳数大，则其具有较高的概率路由时丢失片段。因此，对于小的IP数据包大小或更少的跳数，mesh-under方案可能会比route-over方案更好。Mesh-under方案对于在路径中丢失分片的可能性更大的嘈杂环境来说不是一个好的选择。在某些类型的应用中，如果我们丢失一些IP数据包是没关系的并且如果网络拥有太多的流量，那么mesh-under方案应该比route-over方案更好。


#### 结论

　　在本文中，我们分析了route-over和mesh-under路由方案的概率模型。得出的结论是，从源到目的地的转发分片route-over方案比mesh-under方案更可靠。清楚的是如果在route-over和mesh-under方案中采用选择性重传，route-over方案在传输数量方面表现优于mesh-under方案。然而，在总延时方面，mesh-under方案优于router-over方案。将来，我们要在IEEE 802.15.4仿真环境中模拟route-over和mesh-under方案，并增强其性能评估。我们还计划模拟route-over和mesh-under方案的SRRO和SRMU机制。
