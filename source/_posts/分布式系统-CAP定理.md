---
title: 分布式系统-CAP定理
tags:
  - CAP
categories:
  - Distributed
abbrlink: 26665
date: 2019-10-12 09:40:10
---

　　CAP理论作为分布式系统的基石，应该是每个入门分布式系统（包括区块链）的人都应该学习的内容。

<!--more-->

#### C、 A、P的含义

![12-1](https://fzy-blog.oss-cn-shenzhen.aliyuncs.com/2019/10/12-1.png)

　　CAP 指的是：

- Consistency，一致性。
- Availability，可用性。
- Partition tolerance，分区容错。

##### Consistency

　　一致性指 “`all nodes see the same data at the same time`”，即所有节点在同一时间的数据完全一致。即写操作之后的读操作，必须返回该值。

　　通俗来说，对于客户端的每次读操作，要么读到的是最新的数据，要么读取失败。换句话说，一致性是站在分布式系统的角度，对访问本系统的客户端的一种承诺：要么我给您返回一个错误，要么我给你返回绝对一致的最新数据，不难看出，其强调的是数据正确。

##### Availability

　　可用性指 “`Reads and writes always succeed`”，即服务在正常响应时间内一直可用。只要收到用户的请求，服务器就必须给出回应。

　　通俗来说，任何客户端的请求都能得到响应数据，不会出现响应错误。换句话说，可用性是站在分布式系统的角度，对访问本系统的客户的另一种承诺：我一定会给您返回数据，不会给你返回错误，但不保证数据最新，强调的是不出错。

##### Partition tolerance

　　分区容错性指 “`the system continues to operate despite arbitrary message loss or failure of part of the system`”，即分布式系统在遇到某节点或网络分区故障的时候，仍然能够对外提供满足一致性或可用性的服务。

　　通俗来说，由于分布式系统通过网络进行通信，网络是不可靠的。当任意数量的消息丢失或延迟到达时，系统仍会继续提供服务，不会挂掉。换句话说，分区容忍性是站在分布式系统的角度，对访问本系统的客户端的再一种承诺：我会一直运行，不管我的内部出现何种数据同步问题，强调的是不挂掉。

#### C、A、P三者之间的冲突

　　CAP 理论说的就是：一个分布式系统，不可能同时做到这三点。但是，不要以为在所有时候都只能选择两个特性。在不存在网络失败的情况下（分布式系统正常运行时），C 和 A能够同时保证。只有当网络发生分区或失败时，才会在 C 和 A 之间做出选择。

　　对于一个分布式系统而言，P 是前提，必须保证，因为只要有网络交互就一定会有延迟和数据丢失，这种状况必须接受，必须保证系统不能挂掉。所以只剩下C、A可以选择。要么保证数据一致性（保证数据绝对正确），要么保证可用性（保证系统不出错）。

　　由于分区容错性可能出现，因此一致性和可用性不可能同时成立。系统设计时只能选择一个目标。如果追求一致性，那么无法保证所有节点的可用性；如果追求所有节点的可用性，那就没法做到一致性。

　　例如两台服务器，如果保证 S2 的一致性，那么 S1 必须在写操作时，锁定 S2 的读操作和写操作。只有数据同步后，才能重新开放读写。锁定期间，S2 不能读写，没有可用性不。如果保证 S2 的可用性，那么势必不能锁定 S2，所以一致性不成立。